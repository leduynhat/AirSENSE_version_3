

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from docs.espressif.com/projects/esp-idf/en/latest/api-guides/jtag-debugging/debugging-examples.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 29 Feb 2020 06:29:22 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging Examples &mdash; ESP-IDF Programming Guide v4.1-dev-2071-gf91080637 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../../../../media.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tips and Quirks" href="tips-and-quirks.html" />
    <link rel="prev" title="Using Debugger" href="using-debugger.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="debugging-examples.html" />

<link rel="stylesheet" href="../../../../../../../media.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "api-guides/jtag-debugging/debugging-examples"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="../../../../../../../media.readthedocs.com/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index-2.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
            
            <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://docs.espressif.com/projects/esp-idf/en/latest/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../esp32s2.html">ESP32-S2 Preview Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blufi.html">BluFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootloader.html">Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build-system-legacy.html">Build System (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-handling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../esp-ble-mesh/ble-mesh-index.html">ESP-BLE-MESH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mesh.html">ESP-MESH (Wi-Fi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event-handling.html">Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../external-ram.html">External SPI-connected RAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fatal-errors.html">Fatal Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hlinterrupts.html">High Level Interrupts</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">JTAG Debugging</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#how-it-works">How it Works?</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#selecting-jtag-adapter">Selecting JTAG Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#setup-of-openocd">Setup of OpenOCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#configuring-esp32-target">Configuring ESP32 Target</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#launching-debugger">Launching Debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#debugging-examples">Debugging Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#building-openocd-from-sources">Building OpenOCD from Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#tips-and-quirks">Tips and Quirks</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#related-documents">Related Documents</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="using-debugger.html">Using Debugger</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Debugging Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="tips-and-quirks.html">Tips and Quirks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_trace.html">Application Level Tracing library</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../linker-script-generation.html">Linker Script Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lwip.html">lwIP TCP/IP Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../RF_calibration.html">RF Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../romconsole.html">ROM debug console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thread-local-storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ulp.html">ULP Coprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ulp-legacy.html">ULP Coprocessor (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unit-tests-legacy.html">Unit Testing (Legacy GNU Make)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi.html">WiFi Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">语言/Languages</a></li>
<li class="toctree-l1"><a class="reference external" href="https://readthedocs.com/projects/espressif-esp-idf/downloads/">Guide Downloads</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index-2.html">ESP-IDF Programming Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index-2.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Guides</a> &raquo;</li>
        
          <li><a href="index.html">JTAG Debugging</a> &raquo;</li>
        
      <li>Debugging Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/espressif/esp-idf/blob/master/docs/en/api-guides/jtag-debugging/debugging-examples.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="debugging-examples">
<h1>Debugging Examples<a class="headerlink" href="#debugging-examples" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/api-guides/jtag-debugging/debugging-examples.html">[中文]</a></p>
<p>This section describes debugging with GDB from <a class="reference internal" href="#jtag-debugging-examples-eclipse"><span class="std std-ref">Eclipse</span></a> as well as from <a class="reference internal" href="#jtag-debugging-examples-command-line"><span class="std std-ref">Command Line</span></a>.</p>
<div class="section" id="eclipse">
<span id="jtag-debugging-examples-eclipse"></span><h2>Eclipse<a class="headerlink" href="#eclipse" title="Permalink to this headline">¶</a></h2>
<p>Verify if your target is ready and loaded with <a class="reference external" href="https://github.com/espressif/esp-idf/tree/f91080637/examples/get-started/blink">get-started/blink</a> example. Configure and start debugger following steps in section <a class="reference internal" href="using-debugger.html#jtag-debugging-using-debugger-eclipse"><span class="std std-ref">Eclipse</span></a>. Pick up where target was left by debugger, i.e. having the application halted at breakpoint established at <code class="docutils literal notranslate"><span class="pre">app_main()</span></code>.</p>
<div class="align-center figure" id="id8">
<img alt="Debug Perspective in Eclipse" src="../../_images/debug-perspective.jpg" />
<p class="caption"><span class="caption-text">Debug Perspective in Eclipse</span></p>
</div>
<div class="section" id="examples-in-this-section">
<h3>Examples in this section<a class="headerlink" href="#examples-in-this-section" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-01"><span class="std std-ref">Navigating through the code, call stack and threads</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-02"><span class="std std-ref">Setting and clearing breakpoints</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-03"><span class="std std-ref">Halting the target manually</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-04"><span class="std std-ref">Stepping through the code</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-05"><span class="std std-ref">Checking and setting memory</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-06"><span class="std std-ref">Watching and setting program variables</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-eclipse-07"><span class="std std-ref">Setting conditional breakpoints</span></a></li>
</ol>
</div>
<div class="section" id="navigating-through-the-code-call-stack-and-threads">
<span id="jtag-debugging-examples-eclipse-01"></span><h3>Navigating through the code, call stack and threads<a class="headerlink" href="#navigating-through-the-code-call-stack-and-threads" title="Permalink to this headline">¶</a></h3>
<p>When the target is halted, debugger shows the list of threads in “Debug” window. The line of code where program halted is highlighted in another window below, as shown on the following picture. The LED stops blinking.</p>
<div class="align-center figure" id="id9">
<img alt="Target halted during debugging" src="../../_images/debugging-target-halted.jpg" />
<p class="caption"><span class="caption-text">Target halted during debugging</span></p>
</div>
<p>Specific thread where the program halted is expanded showing the call stack. It represents function calls that lead up to the highlighted line of code, where the target halted. The first line of call stack under Thread #1 contains the last called function <code class="docutils literal notranslate"><span class="pre">app_main()</span></code>, that in turn was called from function <code class="docutils literal notranslate"><span class="pre">main_task()</span></code> shown in a line below. Each line of the stack also contains the file name and line number where the function was called. By clicking / highlighting the stack entries, in window below, you will see contents of this file.</p>
<p>By expanding threads you can navigate throughout the application. Expand Thread #5 that contains much longer call stack. You will see there, besides function calls, numbers like <code class="docutils literal notranslate"><span class="pre">0x4000000c</span></code>. They represent addresses of binary code not provided in source form.</p>
<div class="align-center figure" id="id10">
<img alt="Navigate through the call stack" src="../../_images/debugging-navigate-through-the-stack.jpg" />
<p class="caption"><span class="caption-text">Navigate through the call stack</span></p>
</div>
<p>In another window on right, you can see the disassembled machine code no matter if your project provides it in source or only the binary form.</p>
<p>Go back to the <code class="docutils literal notranslate"><span class="pre">app_main()</span></code> in Thread #1 to familiar code of <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> file that will be examined in more details in the following examples. Debugger makes it easy to navigate through the code of entire application. This comes handy when stepping through the code and working with breakpoints and will be discussed below.</p>
</div>
<div class="section" id="setting-and-clearing-breakpoints">
<span id="jtag-debugging-examples-eclipse-02"></span><h3>Setting and clearing breakpoints<a class="headerlink" href="#setting-and-clearing-breakpoints" title="Permalink to this headline">¶</a></h3>
<p>When debugging, we would like to be able to stop the application at critical lines of code and then examine the state of specific variables, memory and registers / peripherals. To do so we are using breakpoints. They provide a convenient way to quickly get to and halt the application at specific line.</p>
<p>Let’s establish two breakpoints when the state of LED changes. Basing on code listing above, this happens at lines 33 and 36. To do so, hold the “Control” on the keyboard and double clink on number <code class="docutils literal notranslate"><span class="pre">33</span></code> in file <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> file. A dialog will open where you can confirm your selection by pressing “OK” button. If you do not like to see the dialog just double click the line number. Set another breakpoint in line 36.</p>
<div class="align-center figure" id="id11">
<img alt="Setting a breakpoint" src="../../_images/debugging-setting-breakpoint.jpg" />
<p class="caption"><span class="caption-text">Setting a breakpoint</span></p>
</div>
<p>Information how many breakpoints are set and where is shown in window “Breakpoints” on top right. Click “Show Breakpoints Supported by Selected Target” to refresh this list. Besides the two just set breakpoints the list may contain temporary breakpoint at function <code class="docutils literal notranslate"><span class="pre">app_main()</span></code> established at debugger start. As maximum two breakpoints are allowed (see <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-breakpoints"><span class="std std-ref">Breakpoints and watchpoints available</span></a>), you need to delete it, or debugging will fail.</p>
<div class="align-center figure" id="id12">
<img alt="Three breakpoints are set / maximum two are allowed" src="../../_images/debugging-three-breakpoints-set.jpg" />
<p class="caption"><span class="caption-text">Three breakpoints are set / maximum two are allowed</span></p>
</div>
<p>If you now click “Resume” (click <code class="docutils literal notranslate"><span class="pre">blink_task()</span></code> under “Tread #8”, if “Resume” button is grayed out), the processor will run and halt at a breakpoint. Clicking “Resume” another time will make it run again, halt on second breakpoint, and so on.</p>
<p>You will be also able to see that LED is changing the state after each click to “Resume” program execution.</p>
<p>Read more about breakpoints under <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-breakpoints"><span class="std std-ref">Breakpoints and watchpoints available</span></a> and <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-where-breakpoints"><span class="std std-ref">What else should I know about breakpoints?</span></a></p>
</div>
<div class="section" id="halting-the-target-manually">
<span id="jtag-debugging-examples-eclipse-03"></span><h3>Halting the target manually<a class="headerlink" href="#halting-the-target-manually" title="Permalink to this headline">¶</a></h3>
<p>When debugging, you may resume application and enter code waiting for some event or staying in infinite loop without any break points defined. In such case, to go back to debugging mode, you can break program execution manually by pressing “Suspend” button.</p>
<p>To check it, delete all breakpoints and click “Resume”. Then click “Suspend”. Application will be halted at some random point and LED will stop blinking. Debugger will expand tread and highlight the line of code where application halted.</p>
<div class="align-center figure" id="id13">
<img alt="Target halted manually" src="../../_images/debugging-target-halted-manually.jpg" />
<p class="caption"><span class="caption-text">Target halted manually</span></p>
</div>
<p>In particular case above, the application has been halted in line 52 of code in file <code class="docutils literal notranslate"><span class="pre">freertos_hooks.c</span></code> Now you can resume it again by pressing “Resume” button or do some debugging as discussed below.</p>
</div>
<div class="section" id="stepping-through-the-code">
<span id="jtag-debugging-examples-eclipse-04"></span><h3>Stepping through the code<a class="headerlink" href="#stepping-through-the-code" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to step through the code using “Step Into (F5)” and “Step Over (F6)” commands. The difference is that “Step Into (F5)” is entering inside subroutines calls, while “Step Over (F6)” steps over the call, treating it as a single source line.</p>
<p>Before being able to demonstrate this functionality, using information discussed in previous paragraph, make sure that you have only one breakpoint defined at line <code class="docutils literal notranslate"><span class="pre">36</span></code> of <code class="docutils literal notranslate"><span class="pre">blink.c</span></code>.</p>
<p>Resume program by entering pressing F8 and let it halt. Now press “Step Over (F6)”, one by one couple of times, to see how debugger is stepping one program line at a time.</p>
<div class="align-center figure" id="id14">
<img alt="Stepping through the code with &quot;Step Over (F6)&quot;" src="../../_images/debugging-step-over.jpg" />
<p class="caption"><span class="caption-text">Stepping through the code with “Step Over (F6)”</span></p>
</div>
<p>If you press “Step Into (F5)” instead, then debugger will step inside subroutine calls.</p>
<div class="align-center figure" id="id15">
<img alt="Stepping through the code with &quot;Step Into (F5)&quot;" src="../../_images/debugging-step-into.jpg" />
<p class="caption"><span class="caption-text">Stepping through the code with “Step Into (F5)”</span></p>
</div>
<p>In this particular case debugger stepped inside <code class="docutils literal notranslate"><span class="pre">gpio_set_level(BLINK_GPIO,</span> <span class="pre">0)</span></code> and effectively moved to <code class="docutils literal notranslate"><span class="pre">gpio.c</span></code> driver code.</p>
<p>See <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-why-next-works-as-step"><span class="std std-ref">Why stepping with “next” does not bypass subroutine calls?</span></a> for potential limitation of using <code class="docutils literal notranslate"><span class="pre">next</span></code> command.</p>
</div>
<div class="section" id="checking-and-setting-memory">
<span id="jtag-debugging-examples-eclipse-05"></span><h3>Checking and setting memory<a class="headerlink" href="#checking-and-setting-memory" title="Permalink to this headline">¶</a></h3>
<p>To display or set contents of memory use “Memory” tab at the bottom of “Debug” perspective.</p>
<p>With the “Memory” tab, we will read from and write to the memory location <code class="docutils literal notranslate"><span class="pre">0x3FF44004</span></code> labeled as <code class="docutils literal notranslate"><span class="pre">GPIO_OUT_REG</span></code> used to set and clear individual GPIO’s. For more information please refer to <a class="reference external" href="https://espressif.com/sites/default/files/documentation/esp32_technical_reference_manual_en.pdf">ESP32 Technical Reference Manual</a>, chapter IO_MUX and GPIO Matrix.</p>
<p>Being in the same <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> project as before, set two breakpoints right after <code class="docutils literal notranslate"><span class="pre">gpio_set_level</span></code> instruction. Click “Memory” tab and then “Add Memory Monitor” button. Enter <code class="docutils literal notranslate"><span class="pre">0x3FF44004</span></code> in provided dialog.</p>
<p>Now resume program by pressing F8 and observe “Monitor” tab.</p>
<div class="align-center figure" id="id16">
<img alt="Observing memory location 0x3FF44004 changing one bit to ON&quot;" src="../../_images/debugging-memory-location-on.jpg" />
<p class="caption"><span class="caption-text">Observing memory location 0x3FF44004 changing one bit to “ON”</span></p>
</div>
<p>You should see one bit being flipped over at memory location <code class="docutils literal notranslate"><span class="pre">0x3FF44004</span></code> (and LED changing the state) each time F8 is pressed.</p>
<div class="align-center figure" id="id17">
<img alt="Observing memory location 0x3FF44004 changing one bit to ON&quot;" src="../../_images/debugging-memory-location-off.jpg" />
<p class="caption"><span class="caption-text">Observing memory location 0x3FF44004 changing one bit to “OFF”</span></p>
</div>
<p>To set memory use the same “Monitor” tab and the same memory location. Type in alternate bit pattern as previously observed. Immediately after pressing enter you will see LED changing the state.</p>
</div>
<div class="section" id="watching-and-setting-program-variables">
<span id="jtag-debugging-examples-eclipse-06"></span><h3>Watching and setting program variables<a class="headerlink" href="#watching-and-setting-program-variables" title="Permalink to this headline">¶</a></h3>
<p>A common debugging tasks is checking the value of a program variable as the program runs. To be able to demonstrate this functionality, update file <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> by adding a declaration of a global variable <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">i</span></code> above definition of function <code class="docutils literal notranslate"><span class="pre">blink_task</span></code>. Then add <code class="docutils literal notranslate"><span class="pre">i++</span></code> inside <code class="docutils literal notranslate"><span class="pre">while(1)</span></code> of this function to get <code class="docutils literal notranslate"><span class="pre">i</span></code> incremented on each blink.</p>
<p>Exit debugger, so it is not confused with new code, build and flash the code to the ESP and restart debugger. There is no need to restart OpenOCD.</p>
<p>Once application is halted, enter a breakpoint in the line where you put <code class="docutils literal notranslate"><span class="pre">i++</span></code>.</p>
<p>In next step, in the window with “Breakpoints”, click the “Expressions” tab. If this tab is not visible, then add it by going to the top menu Window &gt; Show View &gt; Expressions. Then click “Add new expression” and enter <code class="docutils literal notranslate"><span class="pre">i</span></code>.</p>
<p>Resume program execution by pressing F8. Each time the program is halted you will see <code class="docutils literal notranslate"><span class="pre">i</span></code> value being incremented.</p>
<div class="align-center figure" id="id18">
<img alt="Watching program variable &quot;i&quot;" src="../../_images/debugging-watch-variable.jpg" />
<p class="caption"><span class="caption-text">Watching program variable “i”</span></p>
</div>
<p>To modify <code class="docutils literal notranslate"><span class="pre">i</span></code> enter a new number in “Value” column. After pressing “Resume (F8)” the program will keep incrementing <code class="docutils literal notranslate"><span class="pre">i</span></code> starting from the new entered number.</p>
</div>
<div class="section" id="setting-conditional-breakpoints">
<span id="jtag-debugging-examples-eclipse-07"></span><h3>Setting conditional breakpoints<a class="headerlink" href="#setting-conditional-breakpoints" title="Permalink to this headline">¶</a></h3>
<p>Here comes more interesting part. You may set a breakpoint to halt the program execution, if certain condition is satisfied. Right click on the breakpoint to open a context menu and select “Breakpoint Properties”. Change the selection under “Type:” to “Hardware” and enter a “Condition:” like <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">2</span></code>.</p>
<div class="align-center figure" id="id19">
<img alt="Setting a conditional breakpoint" src="../../_images/debugging-setting-conditional-breakpoint.jpg" />
<p class="caption"><span class="caption-text">Setting a conditional breakpoint</span></p>
</div>
<p>If current value of <code class="docutils literal notranslate"><span class="pre">i</span></code> is less than <code class="docutils literal notranslate"><span class="pre">2</span></code> (change it if required) and program is resumed, it will blink LED in a loop until condition <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">2</span></code> gets true and then finally halt.</p>
</div>
</div>
<div class="section" id="command-line">
<span id="jtag-debugging-examples-command-line"></span><h2>Command Line<a class="headerlink" href="#command-line" title="Permalink to this headline">¶</a></h2>
<p>Verify if your target is ready and loaded with <a class="reference external" href="https://github.com/espressif/esp-idf/tree/f91080637/examples/get-started/blink">get-started/blink</a> example. Configure and start debugger following steps in section <a class="reference internal" href="using-debugger.html#jtag-debugging-using-debugger-command-line"><span class="std std-ref">Command Line</span></a>. Pick up where target was left by debugger, i.e. having the application halted at breakpoint established at <code class="docutils literal notranslate"><span class="pre">app_main()</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Temporary breakpoint 1, app_main () at /home/user-name/esp/blink/main/./blink.c:43
43      xTaskCreate(&amp;blink_task, &quot;blink_task&quot;, configMINIMAL_STACK_SIZE, NULL, 5, NULL);
(gdb)
</pre></div>
</div>
<div class="section" id="id1">
<h3>Examples in this section<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-01"><span class="std std-ref">Navigating through the code, call stack and threads</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-02"><span class="std std-ref">Setting and clearing breakpoints</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-03"><span class="std std-ref">Halting and resuming the application</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-04"><span class="std std-ref">Stepping through the code</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-05"><span class="std std-ref">Checking and setting memory</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-06"><span class="std std-ref">Watching and setting program variables</span></a></li>
<li><a class="reference internal" href="#jtag-debugging-examples-command-line-07"><span class="std std-ref">Setting conditional breakpoints</span></a></li>
</ol>
</div>
<div class="section" id="jtag-debugging-examples-command-line-01">
<span id="id2"></span><h3>Navigating through the code, call stack and threads<a class="headerlink" href="#jtag-debugging-examples-command-line-01" title="Permalink to this headline">¶</a></h3>
<p>When you see the <code class="docutils literal notranslate"><span class="pre">(gdb)</span></code> prompt, the application is halted. LED should not be blinking.</p>
<p>To find out where exactly the code is halted, enter <code class="docutils literal notranslate"><span class="pre">l</span></code> or <code class="docutils literal notranslate"><span class="pre">list</span></code>, and debugger will show couple of lines of code around the halt point (line 43 of code in file <code class="docutils literal notranslate"><span class="pre">blink.c</span></code>)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) l
38      }
39  }
40
41  void app_main()
42  {
43      xTaskCreate(&amp;blink_task, &quot;blink_task&quot;, configMINIMAL_STACK_SIZE, NULL, 5, NULL);
44  }
(gdb)
</pre></div>
</div>
<p>Check how code listing works by entering, e.g. <code class="docutils literal notranslate"><span class="pre">l</span> <span class="pre">30,</span> <span class="pre">40</span></code> to see particular range of lines of code.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">bt</span></code> or <code class="docutils literal notranslate"><span class="pre">backtrace</span></code> to see what function calls lead up to this code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) bt
#0  app_main () at /home/user-name/esp/blink/main/./blink.c:43
#1  0x400d057e in main_task (args=0x0) at /home/user-name/esp/esp-idf/components/esp32/./cpu_start.c:339
(gdb)
</pre></div>
</div>
<p>Line #0 of output provides the last function call before the application halted, i.e. <code class="docutils literal notranslate"><span class="pre">app_main</span> <span class="pre">()</span></code> we have listed previously. The <code class="docutils literal notranslate"><span class="pre">app_main</span> <span class="pre">()</span></code> was in turn called by function <code class="docutils literal notranslate"><span class="pre">main_task</span></code> from line 339 of code located in file <code class="docutils literal notranslate"><span class="pre">cpu_start.c</span></code>.</p>
<p>To get to the context of <code class="docutils literal notranslate"><span class="pre">main_task</span></code> in file <code class="docutils literal notranslate"><span class="pre">cpu_start.c</span></code>, enter <code class="docutils literal notranslate"><span class="pre">frame</span>&#160; <span class="pre">N</span></code>, where N = 1, because the <code class="docutils literal notranslate"><span class="pre">main_task</span></code> is listed under #1):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) frame 1
#1  0x400d057e in main_task (args=0x0) at /home/user-name/esp/esp-idf/components/esp32/./cpu_start.c:339
339     app_main();
(gdb)
</pre></div>
</div>
<p>Enter <code class="docutils literal notranslate"><span class="pre">l</span></code> and this will reveal the piece of code that called <code class="docutils literal notranslate"><span class="pre">app_main()</span></code> (in line 339):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) l
334         ;
335     }
336 #endif
337     //Enable allocation in region where the startup stacks were located.
338     heap_caps_enable_nonos_stack_heaps();
339     app_main();
340     vTaskDelete(NULL);
341 }
342
(gdb)
</pre></div>
</div>
<p>By listing some lines before, you will see the function name <code class="docutils literal notranslate"><span class="pre">main_task</span></code> we have been looking for:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) l 326, 341
326 static void main_task(void* args)
327 {
328     // Now that the application is about to start, disable boot watchdogs
329     REG_CLR_BIT(TIMG_WDTCONFIG0_REG(0), TIMG_WDT_FLASHBOOT_MOD_EN_S);
330     REG_CLR_BIT(RTC_CNTL_WDTCONFIG0_REG, RTC_CNTL_WDT_FLASHBOOT_MOD_EN);
331 #if !CONFIG_FREERTOS_UNICORE
332     // Wait for FreeRTOS initialization to finish on APP CPU, before replacing its startup stack
333     while (port_xSchedulerRunning[1] == 0) {
334         ;
335     }
336 #endif
337     //Enable allocation in region where the startup stacks were located.
338     heap_caps_enable_nonos_stack_heaps();
339     app_main();
340     vTaskDelete(NULL);
341 }
(gdb)
</pre></div>
</div>
<p>To see the other code, enter <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">threads</span></code>. This will show the list of threads running on target:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) i threads
  Id   Target Id         Frame
  8    Thread 1073411336 (dport) 0x400d0848 in dport_access_init_core (arg=&lt;optimized out&gt;)
    at /home/user-name/esp/esp-idf/components/esp32/./dport_access.c:170
  7    Thread 1073408744 (ipc0) xQueueGenericReceive (xQueue=0x3ffae694, pvBuffer=0x0, xTicksToWait=1644638200,
    xJustPeeking=0) at /home/user-name/esp/esp-idf/components/freertos/./queue.c:1452
  6    Thread 1073431096 (Tmr Svc) prvTimerTask (pvParameters=0x0)
    at /home/user-name/esp/esp-idf/components/freertos/./timers.c:445
  5    Thread 1073410208 (ipc1 : Running) 0x4000bfea in ?? ()
  4    Thread 1073432224 (dport) dport_access_init_core (arg=0x0)
    at /home/user-name/esp/esp-idf/components/esp32/./dport_access.c:150
  3    Thread 1073413156 (IDLE) prvIdleTask (pvParameters=0x0)
    at /home/user-name/esp/esp-idf/components/freertos/./tasks.c:3282
  2    Thread 1073413512 (IDLE) prvIdleTask (pvParameters=0x0)
    at /home/user-name/esp/esp-idf/components/freertos/./tasks.c:3282
* 1    Thread 1073411772 (main : Running) app_main () at /home/user-name/esp/blink/main/./blink.c:43
(gdb)
</pre></div>
</div>
<p>The thread list shows the last function calls per each thread together with the name of C source file if available.</p>
<p>You can navigate to specific thread by entering  <code class="docutils literal notranslate"><span class="pre">thread</span> <span class="pre">N</span></code>, where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the thread Id. To see how it works go to thread thread 5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) thread 5
[Switching to thread 5 (Thread 1073410208)]
#0  0x4000bfea in ?? ()
(gdb)
</pre></div>
</div>
<p>Then check the backtrace:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) bt
#0  0x4000bfea in ?? ()
#1  0x40083a85 in vPortCPUReleaseMutex (mux=&lt;optimized out&gt;) at /home/user-name/esp/esp-idf/components/freertos/./port.c:415
#2  0x40083fc8 in vTaskSwitchContext () at /home/user-name/esp/esp-idf/components/freertos/./tasks.c:2846
#3  0x4008532b in _frxt_dispatch ()
#4  0x4008395c in xPortStartScheduler () at /home/user-name/esp/esp-idf/components/freertos/./port.c:222
#5  0x4000000c in ?? ()
#6  0x4000000c in ?? ()
#7  0x4000000c in ?? ()
#8  0x4000000c in ?? ()
(gdb)
</pre></div>
</div>
<p>As you see, the backtrace  may contain several entries. This will let you check what exact sequence of function calls lead to the code where the target halted. Question marks <code class="docutils literal notranslate"><span class="pre">??</span></code> instead of a function name indicate that application is available only in binary format, without any source file in C language. The value like <code class="docutils literal notranslate"><span class="pre">0x4000bfea</span></code> is the memory address of the function call.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">bt</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">threads</span></code>, <code class="docutils literal notranslate"><span class="pre">thread</span> <span class="pre">N</span></code> and <code class="docutils literal notranslate"><span class="pre">list</span></code> commands we are now able to navigate through the code of entire application. This comes handy when stepping through the code and working with breakpoints and will be discussed below.</p>
</div>
<div class="section" id="jtag-debugging-examples-command-line-02">
<span id="id3"></span><h3>Setting and clearing breakpoints<a class="headerlink" href="#jtag-debugging-examples-command-line-02" title="Permalink to this headline">¶</a></h3>
<p>When debugging, we would like to be able to stop the application at critical lines of code and then examine the state of specific variables, memory and registers / peripherals. To do so we are using breakpoints. They provide a convenient way to quickly get to and halt the application at specific line.</p>
<p>Let’s establish two breakpoints when the state of LED changes. Basing on code listing above this happens at lines 33 and 36. Breakpoints may be established using command <code class="docutils literal notranslate"><span class="pre">break</span> <span class="pre">M</span></code> where M is the code line number:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) break 33
Breakpoint 2 at 0x400db6f6: file /home/user-name/esp/blink/main/./blink.c, line 33.
(gdb) break 36
Breakpoint 3 at 0x400db704: file /home/user-name/esp/blink/main/./blink.c, line 36.
</pre></div>
</div>
<p>If you new enter <code class="docutils literal notranslate"><span class="pre">c</span></code>, the processor will run and halt at a breakpoint. Entering <code class="docutils literal notranslate"><span class="pre">c</span></code> another time will make it run again, halt on second breakpoint, and so on:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB6F6 (active)    APP_CPU: PC=0x400D10D8

Breakpoint 2, blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:33
33          gpio_set_level(BLINK_GPIO, 0);
(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB6F8 (active)    APP_CPU: PC=0x400D10D8
Target halted. PRO_CPU: PC=0x400DB704 (active)    APP_CPU: PC=0x400D10D8

Breakpoint 3, blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:36
36          gpio_set_level(BLINK_GPIO, 1);
(gdb)
</pre></div>
</div>
<p>You will be also able to see that LED is changing the state only if you resume program execution by entering <code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<p>To examine how many breakpoints are set and where, use command <code class="docutils literal notranslate"><span class="pre">info</span> <span class="pre">break</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) info break
Num     Type           Disp Enb Address    What
2       breakpoint     keep y   0x400db6f6 in blink_task at /home/user-name/esp/blink/main/./blink.c:33
    breakpoint already hit 1 time
3       breakpoint     keep y   0x400db704 in blink_task at /home/user-name/esp/blink/main/./blink.c:36
    breakpoint already hit 1 time
(gdb)
</pre></div>
</div>
<p>Please note that breakpoint numbers (listed under <code class="docutils literal notranslate"><span class="pre">Num</span></code>) start with <code class="docutils literal notranslate"><span class="pre">2</span></code>. This is because first breakpoint has been already established at function <code class="docutils literal notranslate"><span class="pre">app_main()</span></code> by running command <code class="docutils literal notranslate"><span class="pre">thb</span> <span class="pre">app_main</span></code> on debugger launch. As it was a temporary breakpoint, it has been automatically deleted and now is not listed anymore.</p>
<p>To remove breakpoints enter <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">N</span></code> command (in short <code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">N</span></code>), where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the breakpoint number:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) delete 1
No breakpoint number 1.
(gdb) delete 2
(gdb)
</pre></div>
</div>
<p>Read more about breakpoints under <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-breakpoints"><span class="std std-ref">Breakpoints and watchpoints available</span></a> and <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-where-breakpoints"><span class="std std-ref">What else should I know about breakpoints?</span></a></p>
</div>
<div class="section" id="halting-and-resuming-the-application">
<span id="jtag-debugging-examples-command-line-03"></span><h3>Halting and resuming the application<a class="headerlink" href="#halting-and-resuming-the-application" title="Permalink to this headline">¶</a></h3>
<p>When debugging, you may resume application and enter code waiting for some event or staying in infinite loop without any break points defined. In such case, to go back to debugging mode, you can break program execution manually by entering Ctrl+C.</p>
<p>To check it delete all breakpoints and enter <code class="docutils literal notranslate"><span class="pre">c</span></code> to resume application. Then enter Ctrl+C. Application will be halted at some random point and LED will stop blinking. Debugger will print the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) c
Continuing.
^CTarget halted. PRO_CPU: PC=0x400D0C00             APP_CPU: PC=0x400D0C00 (active)
[New Thread 1073433352]

Program received signal SIGINT, Interrupt.
[Switching to Thread 1073413512]
0x400d0c00 in esp_vApplicationIdleHook () at /home/user-name/esp/esp-idf/components/esp32/./freertos_hooks.c:52
52          asm(&quot;waiti 0&quot;);
(gdb)
</pre></div>
</div>
<p>In particular case above, the application has been halted in line 52 of code in file <code class="docutils literal notranslate"><span class="pre">freertos_hooks.c</span></code>. Now you can resume it again by enter <code class="docutils literal notranslate"><span class="pre">c</span></code> or do some debugging as discussed below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In MSYS2 shell Ctrl+C does not halt the target but exists debugger. To resolve this issue consider debugging with <a class="reference internal" href="#jtag-debugging-examples-eclipse"><span class="std std-ref">Eclipse</span></a> or check a workaround under <a class="reference external" href="http://www.mingw.org/wiki/Workaround_for_GDB_Ctrl_C_Interrupt">http://www.mingw.org/wiki/Workaround_for_GDB_Ctrl_C_Interrupt</a>.</p>
</div>
</div>
<div class="section" id="jtag-debugging-examples-command-line-04">
<span id="id4"></span><h3>Stepping through the code<a class="headerlink" href="#jtag-debugging-examples-command-line-04" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to step through the code using <code class="docutils literal notranslate"><span class="pre">step</span></code> and <code class="docutils literal notranslate"><span class="pre">next</span></code> commands (in short <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code>). The difference is that <code class="docutils literal notranslate"><span class="pre">step</span></code> is entering inside subroutines calls, while <code class="docutils literal notranslate"><span class="pre">next</span></code> steps over the call, treating it as a single source line.</p>
<p>To demonstrate this functionality, using command <code class="docutils literal notranslate"><span class="pre">break</span></code> and <code class="docutils literal notranslate"><span class="pre">delete</span></code> discussed in previous paragraph, make sure that you have only one breakpoint defined at line <code class="docutils literal notranslate"><span class="pre">36</span></code> of <code class="docutils literal notranslate"><span class="pre">blink.c</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) info break
Num     Type           Disp Enb Address    What
3       breakpoint     keep y   0x400db704 in blink_task at /home/user-name/esp/blink/main/./blink.c:36
    breakpoint already hit 1 time
(gdb)
</pre></div>
</div>
<p>Resume program by entering <code class="docutils literal notranslate"><span class="pre">c</span></code> and let it halt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB754 (active)    APP_CPU: PC=0x400D1128

Breakpoint 3, blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:36
36          gpio_set_level(BLINK_GPIO, 1);
(gdb)
</pre></div>
</div>
<p>Then enter <code class="docutils literal notranslate"><span class="pre">n</span></code> couple of times to see how debugger is stepping one program line at a time:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) n
Target halted. PRO_CPU: PC=0x400DB756 (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB758 (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DC04C (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB75B (active)    APP_CPU: PC=0x400D1128
37          vTaskDelay(1000 / portTICK_PERIOD_MS);
(gdb) n
Target halted. PRO_CPU: PC=0x400DB75E (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400846FC (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB761 (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB746 (active)    APP_CPU: PC=0x400D1128
33          gpio_set_level(BLINK_GPIO, 0);
(gdb)
</pre></div>
</div>
<p>If you enter <code class="docutils literal notranslate"><span class="pre">s</span></code> instead, then debugger will step inside subroutine calls:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) s
Target halted. PRO_CPU: PC=0x400DB748 (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB74B (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DC04C (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DC04F (active)    APP_CPU: PC=0x400D1128
gpio_set_level (gpio_num=GPIO_NUM_4, level=0) at /home/user-name/esp/esp-idf/components/driver/./gpio.c:183
183     GPIO_CHECK(GPIO_IS_VALID_OUTPUT_GPIO(gpio_num), &quot;GPIO output gpio_num error&quot;, ESP_ERR_INVALID_ARG);
(gdb)
</pre></div>
</div>
<p>In this particular case debugger stepped inside <code class="docutils literal notranslate"><span class="pre">gpio_set_level(BLINK_GPIO,</span> <span class="pre">0)</span></code> and effectively moved to <code class="docutils literal notranslate"><span class="pre">gpio.c</span></code> driver code.</p>
<p>See <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-why-next-works-as-step"><span class="std std-ref">Why stepping with “next” does not bypass subroutine calls?</span></a> for potential limitation of using <code class="docutils literal notranslate"><span class="pre">next</span></code> command.</p>
</div>
<div class="section" id="jtag-debugging-examples-command-line-05">
<span id="id5"></span><h3>Checking and setting memory<a class="headerlink" href="#jtag-debugging-examples-command-line-05" title="Permalink to this headline">¶</a></h3>
<p>Displaying the contents of memory is done with command <code class="docutils literal notranslate"><span class="pre">x</span></code>. With additional parameters you may vary the format and count of memory locations displayed. Run <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">x</span></code> to see more details. Companion command to <code class="docutils literal notranslate"><span class="pre">x</span></code> is <code class="docutils literal notranslate"><span class="pre">set</span></code> that let you write values to the memory.</p>
<p>We will demonstrate how <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">set</span></code> work by reading from and writing to the memory location <code class="docutils literal notranslate"><span class="pre">0x3FF44004</span></code> labeled as <code class="docutils literal notranslate"><span class="pre">GPIO_OUT_REG</span></code> used to set and clear individual GPIO’s. For more information please refer to <a class="reference external" href="https://espressif.com/sites/default/files/documentation/esp32_technical_reference_manual_en.pdf">ESP32 Technical Reference Manual</a>, chapter IO_MUX and GPIO Matrix.</p>
<p>Being in the same <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> project as before, set two breakpoints right after <code class="docutils literal notranslate"><span class="pre">gpio_set_level</span></code> instruction. Enter two times <code class="docutils literal notranslate"><span class="pre">c</span></code> to get to the break point followed by <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">/1wx</span> <span class="pre">0x3FF44004</span></code> to display contents of <code class="docutils literal notranslate"><span class="pre">GPIO_OUT_REG</span></code> memory location:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB75E (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB74E (active)    APP_CPU: PC=0x400D1128

Breakpoint 2, blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:34
34          vTaskDelay(1000 / portTICK_PERIOD_MS);
(gdb) x /1wx 0x3FF44004
0x3ff44004: 0x00000000
(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB751 (active)    APP_CPU: PC=0x400D1128
Target halted. PRO_CPU: PC=0x400DB75B (active)    APP_CPU: PC=0x400D1128

Breakpoint 3, blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:37
37          vTaskDelay(1000 / portTICK_PERIOD_MS);
(gdb) x /1wx 0x3FF44004
0x3ff44004: 0x00000010
(gdb)
</pre></div>
</div>
<p>If your are blinking LED connected to GPIO4, then you should see fourth bit being flipped each time the LED changes the state:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x3ff44004: 0x00000000
...
0x3ff44004: 0x00000010
</pre></div>
</div>
<p>Now, when the LED is off, that corresponds to <code class="docutils literal notranslate"><span class="pre">0x3ff44004:</span> <span class="pre">0x00000000</span></code> being displayed, try using <code class="docutils literal notranslate"><span class="pre">set</span></code> command to set this bit by writting <code class="docutils literal notranslate"><span class="pre">0x00000010</span></code> to the same memory location:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) x /1wx 0x3FF44004
0x3ff44004: 0x00000000
(gdb) set {unsigned int}0x3FF44004=0x000010
</pre></div>
</div>
<p>You should see the LED to turn on immediately after entering <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">{unsigned</span> <span class="pre">int}0x3FF44004=0x000010</span></code> command.</p>
</div>
<div class="section" id="jtag-debugging-examples-command-line-06">
<span id="id6"></span><h3>Watching and setting program variables<a class="headerlink" href="#jtag-debugging-examples-command-line-06" title="Permalink to this headline">¶</a></h3>
<p>A common debugging tasks is checking the value of a program variable as the program runs. To be able to demonstrate this functionality, update file <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> by adding a declaration of a global variable <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">i</span></code> above definition of function <code class="docutils literal notranslate"><span class="pre">blink_task</span></code>. Then add <code class="docutils literal notranslate"><span class="pre">i++</span></code> inside <code class="docutils literal notranslate"><span class="pre">while(1)</span></code> of this function to get <code class="docutils literal notranslate"><span class="pre">i</span></code> incremented on each blink.</p>
<p>Exit debugger, so it is not confused with new code, build and flash the code to the ESP and restart debugger. There is no need to restart OpenOCD.</p>
<p>Once application is halted, enter the command <code class="docutils literal notranslate"><span class="pre">watch</span> <span class="pre">i</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) watch i
Hardware watchpoint 2: i
(gdb)
</pre></div>
</div>
<p>This will insert so called “watchpoint” in each place of code where variable <code class="docutils literal notranslate"><span class="pre">i</span></code> is being modified. Now enter <code class="docutils literal notranslate"><span class="pre">continue</span></code> to resume the application and observe it being halted:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB751 (active)    APP_CPU: PC=0x400D0811
[New Thread 1073432196]

Program received signal SIGTRAP, Trace/breakpoint trap.
[Switching to Thread 1073432196]
0x400db751 in blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:33
33          i++;
(gdb)
</pre></div>
</div>
<p>Resume application couple more times so <code class="docutils literal notranslate"><span class="pre">i</span></code> gets incremented. Now you can enter <code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">i</span></code> (in short <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">i</span></code>) to check the current value of <code class="docutils literal notranslate"><span class="pre">i</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) p i
$1 = 3
(gdb)
</pre></div>
</div>
<p>To modify the value of <code class="docutils literal notranslate"><span class="pre">i</span></code> use <code class="docutils literal notranslate"><span class="pre">set</span></code> command as below (you can then print it out to check if it has been indeed changed):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) set var i = 0
(gdb) p i
$3 = 0
(gdb)
</pre></div>
</div>
<p>You may have up to two watchpoints, see <a class="reference internal" href="tips-and-quirks.html#jtag-debugging-tip-breakpoints"><span class="std std-ref">Breakpoints and watchpoints available</span></a>.</p>
</div>
<div class="section" id="jtag-debugging-examples-command-line-07">
<span id="id7"></span><h3>Setting conditional breakpoints<a class="headerlink" href="#jtag-debugging-examples-command-line-07" title="Permalink to this headline">¶</a></h3>
<p>Here comes more interesting part. You may set a breakpoint to halt the program execution, if certain condition is satisfied. Delete existing breakpoints and try this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) break blink.c:34 if (i == 2)
Breakpoint 3 at 0x400db753: file /home/user-name/esp/blink/main/./blink.c, line 34.
(gdb)
</pre></div>
</div>
<p>Above command sets conditional breakpoint to halt program execution in line <code class="docutils literal notranslate"><span class="pre">34</span></code> of <code class="docutils literal notranslate"><span class="pre">blink.c</span></code> if <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">2</span></code>.</p>
<p>If current value of <code class="docutils literal notranslate"><span class="pre">i</span></code> is less than <code class="docutils literal notranslate"><span class="pre">2</span></code> and program is resumed, it will blink LED in a loop until condition <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">2</span></code> gets true and then finally halt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) set var i = 0
(gdb) c
Continuing.
Target halted. PRO_CPU: PC=0x400DB755 (active)    APP_CPU: PC=0x400D112C
Target halted. PRO_CPU: PC=0x400DB753 (active)    APP_CPU: PC=0x400D112C
Target halted. PRO_CPU: PC=0x400DB755 (active)    APP_CPU: PC=0x400D112C
Target halted. PRO_CPU: PC=0x400DB753 (active)    APP_CPU: PC=0x400D112C

Breakpoint 3, blink_task (pvParameter=0x0) at /home/user-name/esp/blink/main/./blink.c:34
34          gpio_set_level(BLINK_GPIO, 0);
(gdb)
</pre></div>
</div>
</div>
<div class="section" id="obtaining-help-on-commands">
<h3>Obtaining help on commands<a class="headerlink" href="#obtaining-help-on-commands" title="Permalink to this headline">¶</a></h3>
<p>Commands presented so for should provide are very basis and intended to let you quickly get started with JTAG debugging. Check help what are the other commands at you disposal. To obtain help on syntax and functionality of particular command, being at <code class="docutils literal notranslate"><span class="pre">(gdb)</span></code> prompt type <code class="docutils literal notranslate"><span class="pre">help</span></code> and command name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) help next
Step program, proceeding through subroutine calls.
Usage: next [N]
Unlike &quot;step&quot;, if the current source line calls a subroutine,
this command does not enter the subroutine, but instead steps over
the call, in effect treating it as a single source line.
(gdb)
</pre></div>
</div>
<p>By typing just <code class="docutils literal notranslate"><span class="pre">help</span></code>, you will get top level list of command classes, to aid you drilling down to more details. Optionally refer to available GDB cheat sheets, for instance <a class="reference external" href="http://darkdust.net/files/GDB Cheat Sheet.pdf">http://darkdust.net/files/GDB%20Cheat%20Sheet.pdf</a>. Good to have as a reference (even if not all commands are applicable in an embedded environment).</p>
</div>
<div class="section" id="ending-debugger-session">
<h3>Ending debugger session<a class="headerlink" href="#ending-debugger-session" title="Permalink to this headline">¶</a></h3>
<p>To quit debugger enter <code class="docutils literal notranslate"><span class="pre">q</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) q
A debugging session is active.

    Inferior 1 [Remote target] will be detached.

Quit anyway? (y or n) y
Detaching from program: /home/user-name/esp/blink/build/blink.elf, Remote target
Ending remote debugging.
user-name@computer-name:~/esp/blink$
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tips-and-quirks.html" class="btn btn-neutral float-right" title="Tips and Quirks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="using-debugger.html" class="btn btn-neutral float-left" title="Using Debugger" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2019, Espressif Systems (Shanghai) CO., LTD
      
        <span class="commit">
          Revision <code>f9108063</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.espressif.com/en/latest/">latest</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/stable/">stable</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v4.0-rc/">v4.0-rc</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v4.0-beta2/">v4.0-beta2</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.3.1/">v3.3.1</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.3/">v3.3</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.2.3/">v3.2.3</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.2.2/">v3.2.2</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.1.6/">v3.1.6</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.1.5/">v3.1.5</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/v3.0.9/">v3.0.9</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/release-v4.1/">release-v4.1</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/release-v4.0/">release-v4.0</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/release-v3.3/">release-v3.3</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/release-v3.2/">release-v3.2</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/release-v3.1/">release-v3.1</a></dd>
        
          <dd><a href="https://docs.espressif.com/en/release-v3.0/">release-v3.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://docs.espressif.com/_/downloads/esp-idf/en/latest/pdf/">pdf</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.com/projects/espressif-esp-idf/?fromdocs=espressif-esp-idf">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.com/builds/espressif-esp-idf/?fromdocs=espressif-esp-idf">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org/">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>

<!-- Mirrored from docs.espressif.com/projects/esp-idf/en/latest/api-guides/jtag-debugging/debugging-examples.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 29 Feb 2020 06:29:32 GMT -->
</html>